<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Uber Driver è¨ˆç®—å™¨ï¼ˆæ·±ç°ç‰ˆï¼‰</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/base.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/components.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/utilities.min.css">
<style>
body { background-color: #0f0f0f; color: #e5e5e5; }
.card { background-color: #1f1f1f; border: 1px solid #333; border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
input, select { background-color: #2a2a2a; color: #e5e5e5; border: 1px solid #444; border-radius: 0.6rem; padding: 0.75rem; width: 100%; }
.btn-main { background-color: #6366f1; color: white; border-radius: 0.75rem; padding: 0.75rem; width: 100%; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.4); transition: 0.2s; }
.btn-main:hover { background-color: #4f46e5; }
.btn-sub { background-color: #444; color: #ddd; border-radius: 0.5rem; padding: 0.5rem 1rem; transition: 0.2s; }
.btn-sub:hover { background-color: #555; }
h1 { color: #f1f1f1; }
label { color: #cfcfcf; font-weight: 500; }
</style>
</head>
<body class="p-4">
<h1 class="text-3xl font-bold text-center mb-6 tracking-wide">Uber Driver è¨ˆç®—å™¨ï¼ˆæ·±ç°ç‰ˆï¼‰</h1>

<div class="text-center mb-6">
  <label class="font-semibold mr-2">é¸æ“‡æ²¹å“ï¼š</label>
  <select id="oilType" class="border p-2 rounded w-40 bg-gray-700" onchange="fetchOilPrice()">
    <option value="92">92 ç„¡é‰›æ±½æ²¹</option>
    <option value="95">95 ç„¡é‰›æ±½æ²¹</option>
    <option value="98">98 ç„¡é‰›æ±½æ²¹</option>
    <option value="diesel">è¶…ç´šæŸ´æ²¹</option>
  </select>
</div>

<div id="oilPriceDisplayMain" class="text-center text-blue-400 font-semibold mb-6 text-lg">è®€å–ä¸­...</div>

<!-- æˆæœ¬è¨­å®šå€ -->
<div class="card">
<h2 class="text-xl font-semibold mb-4 text-blue-300">æˆæœ¬è¨­å®š</h2>
<label>æ²¹è€—è¨­å®š (km/L)</label>
<input id="fuelRate" class="mb-3" />
<label>æ¯å…¬é‡Œè€—ææˆæœ¬ ($/km)</label>
<input id="maintCost" class="mb-4" />
<button class="btn-main" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
</div>

<!-- ç•¶æ—¥æ•¸æ“šè¼¸å…¥ -->
<div class="card">
<h2 class="text-xl font-semibold mb-4 text-blue-300">ç•¶æ—¥æ•¸æ“šè¼¸å…¥</h2>
<label>è¨˜éŒ„æ—¥æœŸ</label>
<input id="recordDate" type="date" class="mb-3" />
<label>ç•¶æ—¥ç‡Ÿæ¥­é¡</label>
<input id="dayIncome" class="mb-3" />
<label>ç•¶æ—¥å¯¦éš›å…¬é‡Œæ•¸</label>
<input id="dayDistance" class="mb-3" />
<label>å·¥ä½œæ™‚æ•¸</label>
<input id="workHours" class="mb-4" />
<button class="btn-main" onclick="saveRecord()">å„²å­˜ç´€éŒ„</button>
</div>

<!-- é ä¼° -->
<div class="card">
<h2 class="text-xl font-semibold mb-4 text-blue-300">å³æ™‚é ä¼°</h2>
<div id="previewResult" class="text-gray-300">å°šç„¡è³‡æ–™</div>
</div>

<!-- æ­·å²ç´€éŒ„ -->
<div class="card">
<h2 class="text-xl font-semibold mb-4 text-blue-300">æ­·å²ç´€éŒ„</h2>
<div id="historyList" class="space-y-3"></div>
</div>

<script>
const workerAPI = "https://ubereat-oil-proxy.leo3026772.workers.dev/";
let globalOilPrice = 27.1;

async function fetchOilPrice() {
  try {
    const res = await fetch(workerAPI);
    const data = await res.json();

    const oilType = document.getElementById('oilType').value;
    const price = data[oilType];

    if (price === undefined) throw new Error("æ²¹å“ç„¡è³‡æ–™");

    globalOilPrice = price;
    document.getElementById('oilPriceDisplayMain').textContent = `æ²¹åƒ¹ (${oilType})ï¼š$${price}/L`;

  } catch (err) {
    document.getElementById('oilPriceDisplayMain').textContent = `æ²¹åƒ¹è®€å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­ $${globalOilPrice}/L`;
    console.error(err);
  }
}

function saveSettings() {
  const fuelRate = document.getElementById('fuelRate').value;
  const maint = document.getElementById('maintCost').value;
  localStorage.setItem('fuelRate', fuelRate);
  localStorage.setItem('maintCost', maint);
  alert('è¨­å®šå·²å„²å­˜');
}

function loadSettings() {
  document.getElementById('fuelRate').value = localStorage.getItem('fuelRate') || 40;
  document.getElementById('maintCost').value = localStorage.getItem('maintCost') || 0.6;
}

function saveRecord() {
  const record = {
    date: document.getElementById('recordDate').value,
    income: parseFloat(document.getElementById('dayIncome').value || 0),
    km: parseFloat(document.getElementById('dayDistance').value || 0),
    hours: parseFloat(document.getElementById('workHours').value || 0),
    oilType: document.getElementById('oilType').value,
    oilPrice: globalOilPrice
  };

  const all = JSON.parse(localStorage.getItem('history') || '[]');
  all.push(record);
  localStorage.setItem('history', JSON.stringify(all));

  alert('ç´€éŒ„å·²å„²å­˜');
  loadHistory();
}

function loadHistory() {
  const list = document.getElementById('historyList');
  list.innerHTML = "";

  const all = JSON.parse(localStorage.getItem('history') || '[]');

  all.forEach((r, idx) => {
    const div = document.createElement('div');
    div.className = "border border-gray-600 p-3 rounded-lg bg-gray-700 text-gray-200";
    div.innerHTML = `
      <div>ğŸ“… ${r.date}</div>
      <div>â›½ æ²¹å“ï¼š${r.oilType}</div>
      <div>ğŸ’² æ²¹åƒ¹ï¼š${r.oilPrice}</div>
      <div>ç‡Ÿæ¥­é¡ï¼š$${r.income}</div>
      <div>å…¬é‡Œæ•¸ï¼š${r.km} km</div>
      <div>æ™‚æ•¸ï¼š${r.hours} å°æ™‚</div>
      <div class='flex space-x-2 mt-2'>
          <button class='btn-sub' onclick='editRecord(${idx})'>ç·¨è¼¯</button>
          <button class='btn-sub' onclick='deleteRecord(${idx})'>åˆªé™¤</button>
      </div>`;
    list.appendChild(div);
  });
}

function editRecord(i) {
  const all = JSON.parse(localStorage.getItem('history') || '[]');
  const r = all[i];
  document.getElementById('recordDate').value = r.date;
  document.getElementById('dayIncome').value = r.income;
  document.getElementById('dayDistance').value = r.km;
  document.getElementById('workHours').value = r.hours;
  document.getElementById('oilType').value = r.oilType;
  alert('å·²è¼‰å…¥è‡³è¼¸å…¥æ¬„ä½ï¼Œå¯ä¿®æ”¹å¾Œé‡æ–°å„²å­˜ã€‚');
}

function deleteRecord(i) {
  const all = JSON.parse(localStorage.getItem('history') || '[]');
  all.splice(i, 1);
  localStorage.setItem('history', JSON.stringify(all));
  loadHistory();
}

window.onload = () => {
  loadSettings();
  loadHistory();
  fetchOilPrice();
};
</script>
</body>
</html>
