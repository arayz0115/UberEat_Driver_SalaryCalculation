<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>UberEat Salary Calculator V1.2.17</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#050505">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/732/732200.png">

<meta property="og:title" content="UberEat å¤–é€è–ªè³‡è¨ˆç®—å™¨ V1.2.17 (çµ±ä¸€åœ–ç¤ºé¢¨æ ¼)" />
<meta property="og:description" content="å°ˆç‚º UberEat å¤–é€å“¡æ‰“é€ ï¼Œç²¾æº–è¨ˆç®—æ¯ä¸€è¶Ÿçš„è–ªè³‡ã€æ²¹è€—èˆ‡è€—ææ·¨åˆ©ï¼Œæ”¯æ´è·¨è£ç½®å¯¦æ™‚åŒæ­¥ï¼Œä¸¦å„ªåŒ–äº†é é¢ä½ˆå±€èˆ‡æ˜ç´°åˆ—è¡¨æ”¶åˆåŠŸèƒ½ã€‚" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://placehold.co/1200x630/059669/ffffff?text=UberEat+V1.2.17" />

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* === å…¨å±€è¨­å®š === */
    body { 
        background-color: #050505; 
        color: #e5e5e5; 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
        padding-bottom: 120px; /* åº•éƒ¨ç•™ç©ºé–“çµ¦ç‰ˆæ¬Š */
        padding-top: env(safe-area-inset-top); /* é¿é–‹ç€æµ· */
    }
    
    /* === å¡ç‰‡æ¨£å¼ === */
    .card {
        background-color: #111216;
        border: 1px solid #2a2d36;
        border-radius: 1rem;
        padding: 1rem;
        margin-bottom: 0.8rem;
        position: relative;
    }
    .card-glow { border-color: #10b981; box-shadow: 0 0 10px rgba(16, 185, 129, 0.1); } /* æ”¹ç‚º UberEat ç¶ è‰²ç³» */

    /* === è¼¸å…¥æ¡† === */
    .input-field {
        background-color: #1a1c23;
        border: 1px solid #333;
        color: #fff;
        border-radius: 0.6rem;
        padding: 0.7rem;
        width: 100%;
        font-size: 1rem;
        transition: 0.2s;
    }
    .input-field:focus { outline: none; border-color: #10b981; background-color: #202229; }

    /* === æ—¥æœŸé¸æ“‡å™¨ (å„ªåŒ–æ‰‹æ©Ÿé¡¯ç¤ºï¼Œç¢ºä¿æ—¥æœŸä¸è¢«è£åˆ‡) === */
    input[type="date"] { position: relative; font-size: 0.95rem; }
    input[type="date"]::-webkit-calendar-picker-indicator {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%;
        color: transparent; background: transparent; cursor: pointer;
    }

    /* === æŒ‰éˆ• === */
    .btn { width: 100%; padding: 0.8rem; border-radius: 0.6rem; font-weight: 600; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
    .btn-primary { background-color: #059669; color: white; } /* UberEat ç¶  */
    .btn-primary:active { background-color: #047857; transform: scale(0.98); }
    .btn-danger { background-color: #7f1d1d; color: #fca5a5; border: 1px solid #991b1b; }
    .btn-ghost { background-color: transparent; border: 1px solid #333; color: #9ca3af; }
    
    .chart-toggle-btn { background: #2a2d36; color: #9ca3af; border: 1px solid #333; }
    .chart-toggle-btn.active { background: #059669; color: white; border-color: #059669; }

    /* === ç¯©é¸ Tab (ä¿®æ­£æ»‘å‹•å•é¡Œ) === */
    .tab-scroll-container {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 0.5rem;
        scrollbar-width: none; 
        -ms-overflow-style: none;
    }
    .tab-scroll-container::-webkit-scrollbar { display: none; }

    .tab-scroll-content {
        display: flex;
        gap: 0.6rem;
        padding-right: 1.5rem; 
        min-width: max-content; 
    }

    .tab-btn {
        padding: 0.5rem 1rem; border-radius: 2rem; font-size: 0.9rem; color: #9ca3af; background: #1a1c23; border: 1px solid #333; white-space: nowrap;
    }
    .tab-btn.active { background-color: #d1fae5; color: #065f46; font-weight: bold; border-color: #fff; }

    /* === æ­·å²åˆ—è¡¨ V1.2.17 æ¨£å¼ä¿®æ­£ (åœ–ç¤ºé¡è‰²èˆ‡å°é½Š) === */
    .history-item {
        background-color: #111216; 
        border-bottom: 1px solid #222; 
        padding-top: 1.25rem; 
        padding-bottom: 0rem; 
        padding-left: 1rem;
        padding-right: 1rem;
        transition: background 0.2s;
        display: flex;
        flex-direction: column; 
    }
    
    .history-header-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        width: 100%;
    }

    .history-main-area {
        display: flex;
        width: calc(100% - 30px); /* ç•™å‡ºåœ–ç¤ºçš„ç©ºé–“ */
        padding-bottom: 1.25rem; 
        cursor: pointer;
        transition: background 0.2s;
    }
    .history-main-area:active { background-color: #1c1e24; } 

    .history-top-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        width: 100%;
    }

    /* V1.2.17: ç¨ç«‹çš„æ”¶åˆ/å±•é–‹åœ–ç¤ºå€åŸŸ - é¡è‰²æ”¹ç‚ºç°è‰²ï¼Œå¾®èª¿ padding-top å¯¦ç¾å‚ç›´ç½®ä¸­å°é½Š */
    .history-toggle-icon {
        width: 30px; 
        height: 100%;
        padding-top: 1px; /* èª¿æ•´å°é½Š */
        color: #9ca3af; /* V1.2.17: çµ±ä¸€ç‚ºç°è‰² */
        cursor: pointer;
        z-index: 10;
        font-size: 1rem;
        transition: transform 0.2s;
        text-align: right;
        flex-shrink: 0;
    }
    
    .history-stat-group {
        display: flex;
        flex-direction: column;
        align-items: flex-start; 
        text-align: left;
    }
    .history-stat-group.center {
        align-items: center; 
        text-align: center;
    }
    .history-stat-group.right {
        align-items: flex-end;
        text-align: right;
    }

    /* ç¢ºä¿é—œéµæ•¸å­—é ‚éƒ¨å°é½Š */
    .history-main-value {
        font-size: 1.5rem; 
        font-weight: bold;
        line-height: 1.1;
        margin-top: 2px;
    }
    .stat-label-small {
        font-size: 0.7rem; 
        color: #6b7280; 
        margin-top: 2px;
        line-height: 1.2;
    }
    
    /* === æ­·å²åˆ—è¡¨åº•éƒ¨è©³ç´°å€å¡Š (é è¨­éš±è—) === */
    .history-sub-stats {
        width: 100%;
        padding-top: 0.75rem; 
        padding-bottom: 1.25rem; 
        font-size: 0.8rem;
        color: #9ca3af;
        margin-top: 0.75rem; 
        border-top: 1px solid #222; 
    }
    
    .history-sub-stats.hidden {
        display: none;
    }

    .history-sub-stats .performance-summary {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid #222; 
    }


    /* === å­—é«”èˆ‡æ¨™ç±¤ === */
    .stat-label { font-size: 0.75rem; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; }
    .text-amber-soft { color: #fcd34d; }

    /* V1.2.17: ç·¨è¼¯å™¨å’Œå„€è¡¨æ¿åœ–ç¤ºé¡è‰²çµ±ä¸€ */
    #editorToggleIcon, #dashboardToggleIcon {
        color: #9ca3af; /* çµ±ä¸€ç‚ºç°è‰² */
    }
    
    /* === ç‰ˆæ¬Š Footer === */
    .footer-credit {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #222;
        color: #525252;
        font-size: 0.75rem;
        letter-spacing: 1px;
    }
</style>
</head>
<body class="max-w-md mx-auto p-3">

    <div class="flex justify-between items-center mb-4 px-1 pt-2">
        <div class="flex items-center gap-2">
            <div class="w-1.5 h-6 bg-green-500 rounded-full"></div>
            <div>
                <h1 class="text-lg font-bold text-white leading-tight">UberEat å¤–é€è–ªè³‡è¨ˆç®—å™¨</h1>
                <div class="text-[10px] text-gray-500">V1.2.17 History Icon Optimized</div>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleAuthPanel()" class="p-2 bg-[#1a1c23] rounded-full text-gray-400 border border-[#333] text-xs active:bg-gray-800">
                â˜ï¸ <span id="authStatusText">æœªç™»å…¥</span>
            </button>
            <button onclick="toggleSettings()" class="p-2 bg-[#1a1c23] rounded-full text-gray-400 border border-[#333] text-xs active:bg-gray-800">
                âš™ï¸ è¨­å®š
            </button>
        </div>
    </div>

    <div id="authPanel" class="hidden mb-4 card border-blue-500/50">
        <h3 class="text-blue-500 font-bold mb-3 text-sm uppercase">Firebase é›²ç«¯é©—è­‰</h3>
        <div id="authContent">
            <div id="authForm" class="grid grid-cols-1 gap-3 mb-3">
                <div>
                    <label class="stat-label mb-1">Email</label>
                    <input id="authEmail" type="email" class="input-field" placeholder="your@email.com" />
                </div>
                <div>
                    <label class="stat-label mb-1">å¯†ç¢¼</label>
                    <input id="authPassword" type="password" class="input-field" placeholder="å¯†ç¢¼ (è‡³å°‘6ä½)" />
                </div>
                <button onclick="registerUser()" class="btn btn-primary text-sm">è¨»å†Š (æ–°å¸³è™Ÿ)</button>
                <button onclick="loginUser()" class="btn btn-ghost text-sm border-blue-600 text-blue-400">ç™»å…¥ (å·²æœ‰å¸³è™Ÿ)</button>
                <button onclick="resetPassword()" class="text-xs text-gray-500 hover:text-gray-400 mt-2">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</button>
            </div>
            
            <div id="userInfo" class="hidden">
                <p class="text-white mb-3">æ­¡è¿ï¼Œ<span id="userEmailDisplay" class="font-semibold text-amber-soft"></span></p>
                <button onclick="logoutUser()" class="btn btn-danger text-sm">ç™»å‡ºä¸¦æ¸…é™¤æœ¬æ©Ÿç‹€æ…‹</button>
            </div>
        </div>
    </div>

    <div id="settingsPanel" class="hidden mb-4 card border-green-900/50">
        <h3 class="text-green-500 font-bold mb-3 text-sm uppercase">å…¨åŸŸåƒæ•¸</h3>
        <div class="grid grid-cols-2 gap-3 mb-3">
            <div>
                <label class="stat-label mb-1">æ²¹å“</label>
                <select id="oilType" class="input-field" onchange="fetchOilPrice()">
                    <option value="92">92 ç„¡é‰›</option>
                    <option value="95">95 ç„¡é‰›</option>
                    <option value="98">98 ç„¡é‰›</option>
                    <option value="diesel">æŸ´æ²¹</option>
                </select>
            </div>
            <div>
                <label class="stat-label mb-1">ç›®å‰æ²¹åƒ¹</label>
                <div id="oilPriceDisplay" class="input-field text-yellow-500 font-bold">è®€å–ä¸­...</div>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-3 mb-3">
            <div>
                <label class="stat-label mb-1">æ²¹è€— (km/L)</label>
                <input id="settingFuelRate" type="number" class="input-field" />
            </div>
            <div>
                <label class="stat-label mb-1">è€—æ ($/km)</label>
                <input id="settingMaint" type="number" step="0.1" class="input-field" />
            </div>
        </div>
        <button onclick="saveSettings()" class="btn btn-primary text-sm">å„²å­˜è¨­å®š</button>
    </div>

    <div class="card card-glow mb-4 p-5" id="editorCard">
        <div class="flex justify-between items-center border-b border-gray-800 pb-2 cursor-pointer" onclick="toggleEditor()">
            <h3 class="font-bold text-white flex items-center gap-2 text-base">
                <span id="editorTitle">ğŸ“ æ–°å¢ç´€éŒ„</span>
            </h3>
            <span id="editorToggleIcon" class="text-xl">â–¼</span>
        </div>
        
        <div id="editorContent" class="pt-4">
            <input type="hidden" id="editId" value="">
            <input type="hidden" id="recordOilPrice" value=""> 
            
            <div class="flex justify-end items-center mb-3">
                 <span id="editorOilHint" class="text-xs text-gray-500 hidden">é–å®šæ²¹åƒ¹: --</span>
            </div>

            <div class="flex flex-col gap-3 mb-4">
                <div>
                    <label class="stat-label mb-1">æ—¥æœŸ</label>
                    <input id="inputDate" type="date" class="input-field cursor-pointer text-sm" onclick="this.showPicker()" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="stat-label mb-1">ç‡Ÿæ¥­é¡</label>
                        <input id="inputIncome" type="number" inputmode="numeric" class="input-field text-amber-soft font-bold text-lg" placeholder="$0" />
                    </div>
                    <div>
                        <label class="stat-label mb-1">å–®æ•¸</label>
                        <input id="inputOrders" type="number" inputmode="numeric" class="input-field" placeholder="0" />
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <div>
                    <label class="stat-label mb-1">é‡Œç¨‹</label>
                    <input id="inputDist" type="number" step="0.1" inputmode="decimal" class="input-field" placeholder="KM" />
                </div>
                <div>
                    <label class="stat-label mb-1">å·¥æ™‚</label>
                    <div class="flex gap-1">
                        <input id="inputHr" type="number" class="input-field text-center px-1" placeholder="æ™‚" />
                        <input id="inputMin" type="number" class="input-field text-center px-1" placeholder="åˆ†" />
                    </div>
                </div>
            </div>

            <div class="flex gap-2">
                <button onclick="saveRecord()" class="btn btn-primary" id="btnSave">å„²å­˜</button>
                <button onclick="deleteCurrentRecord()" class="btn btn-danger hidden" id="btnDelete">åˆªé™¤</button>
                <button onclick="resetEditor()" class="btn btn-ghost hidden" id="btnCancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="card bg-gradient-to-br from-[#111216] to-[#064e3b20] border-green-500/30 p-5 mb-4" id="dashboardCard">
        <div class="flex justify-between items-center cursor-pointer" onclick="toggleDashboard()">
            <h3 class="font-bold text-white flex items-center gap-2 text-sm uppercase">
                <div class="w-1.5 h-4 bg-green-500 rounded-full"></div>
                å€é–“ç¸½ç‡Ÿæ”¶å„€è¡¨æ¿
            </h3>
            <span id="dashboardToggleIcon" class="text-xl">â–¼</span>
        </div>
        
        <div id="dashboardContent" class="pt-4">
            <div class="grid grid-cols-3 gap-2">

                <div class="flex flex-col items-center text-center">
                    <label class="stat-label text-gray-400">å€é–“ç¸½ç‡Ÿæ”¶</label>
                    <div class="text-3xl font-bold text-amber-soft mt-1 tracking-tight">$<span id="dashTotalIncome">0</span></div>
                </div>
                <div class="flex flex-col items-center text-center"> 
                    <label class="stat-label text-red-400">ç¸½æˆæœ¬</label>
                    <div class="text-3xl font-bold text-red-400 mt-1 tracking-tight">$<span id="dashTotalCost">0</span></div> 
                </div>
                <div class="flex flex-col items-center text-center">
                    <label class="stat-label text-green-400">ç¸½æ·¨åˆ©</label>
                    <div class="text-3xl font-bold text-green-400 mt-1 tracking-tight">$<span id="dashNetProfit">0</span></div>
                </div>


                <div class="col-span-3 border-t border-white/10 pt-4 mt-4"></div>

                <div class="flex flex-col items-center text-center">
                    <label class="stat-label text-red-400">æ²¹è€—æˆæœ¬</label>
                    <div class="text-lg font-bold text-red-400 mt-1">$<span id="dashOilCost">0</span></div>
                </div>
                <div class="flex flex-col items-center text-center">
                    <label class="stat-label text-red-400">è€—ææˆæœ¬</label>
                    <div class="text-lg font-bold text-red-400 mt-1">$<span id="dashMaintCost">0</span></div>
                </div>
                <div class="flex flex-col items-center text-center">
                    <label class="stat-label text-gray-400">ç¸½å–®æ•¸ / ç¸½å·¥æ™‚</label>
                    <div class="text-lg font-bold text-white mt-1">
                        <span id="dashOrders">0</span>å–® | 
                        <span id="dashHours">0</span><span class="text-xs text-gray-500">h</span> <span id="dashMinutes">0</span><span class="text-xs text-gray-500">m</span>
                    </div>
                </div>
                
                
                <div class="col-span-3 border-t border-white/10 pt-4 mt-4 grid grid-cols-2 gap-4">
                    <div class="flex flex-col items-center text-center">
                        <label class="stat-label text-amber-soft">æœªæ‰£æˆæœ¬å¯¦è–ª</label>
                        <div class="text-2xl font-bold text-amber-soft my-1 tracking-tight">$<span id="dashGrossHourly">0</span></div>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <label class="stat-label text-green-400">å·²æ‰£æˆæœ¬å¯¦è–ª</label>
                        <div class="text-2xl font-bold text-green-400 my-1 tracking-tight">$<span id="dashNetHourly">0</span></div>
                    </div>
                </div>

                <div class="col-span-3 border-t border-white/10 pt-4 mt-4 grid grid-cols-2 gap-4">
                    <div class="flex flex-col items-center text-center">
                        <label class="stat-label text-amber-soft">æ¯å–®å¹³å‡ç‡Ÿæ”¶</label>
                        <div class="text-xl font-bold text-amber-soft my-1 tracking-tight">$<span id="dashGrossPerOrder">0</span></div>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <label class="stat-label text-green-400">æ¯å–®å¹³å‡æ·¨åˆ©</label>
                        <div class="text-xl font-bold text-green-400 my-1 tracking-tight">$<span id="dashNetPerOrder">0</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-scroll-container mb-3">
        <div class="tab-scroll-content">
            <button class="tab-btn active" onclick="setFilter('day', this)">ä»Šæ—¥</button>
            <button class="tab-btn" onclick="setFilter('week', this)">æœ¬é€±</button>
            <button class="tab-btn" onclick="setFilter('month', this)">æœ¬æœˆ</button>
            <button class="tab-btn" onclick="setFilter('year', this)">æœ¬å¹´</button>
            <button class="tab-btn" onclick="setFilter('all', this)">å…¨éƒ¨</button>
            <button class="tab-btn" onclick="setFilter('custom', this)">è‡ªå®šç¾©</button> 
            <button class="tab-btn border-green-500 text-green-400" onclick="toggleCharts()">ğŸ“ˆ é€²éšåœ–è¡¨åˆ†æ</button>
        </div>
    </div>
    
    <div id="customDateFilter" class="card p-3 mb-4 hidden border-blue-500/30">
        <h3 class="text-xs font-bold text-blue-400 mb-2 uppercase">è‡ªå®šç¾©å€é–“ç¯©é¸</h3>
        <div class="flex gap-2 items-center">
            <input type="date" id="filterStart" class="input-field text-sm py-1" onchange="applyCustomFilter()" />
            <span class="text-gray-500">è‡³</span>
            <input type="date" id="filterEnd" class="input-field text-sm py-1" onchange="applyCustomFilter()" />
        </div>
    </div>

    <div id="chartsPanel" class="hidden card mb-4 border border-green-500/30">
        <div class="flex justify-between items-center mb-3">
            <h4 class="text-sm font-bold text-white">ğŸ“Š æ•¸æ“šåˆ†æä¸­å¿ƒ</h4>
            <div class="flex bg-[#1a1c23] rounded-lg p-1">
                <button onclick="switchChartType('bar')" id="btnChartBar" class="chart-toggle-btn active px-3 py-1 rounded text-xs">è¶¨å‹¢åœ–</button>
                <button onclick="switchChartType('pie')" id="btnChartPie" class="chart-toggle-btn px-3 py-1 rounded text-xs">åœ“é¤…åœ–</button>
            </div>
        </div>

        <div class="bg-[#1a1c23] p-2 rounded-lg mb-3">
            <div class="flex gap-2 mb-2">
                <input type="date" id="chartStart" class="input-field text-xs py-1" onchange="updateChart()" />
                <span class="text-gray-500 self-center">~</span>
                <input type="date" id="chartEnd" class="input-field text-xs py-1" onchange="updateChart()" />
            </div>
            <div class="flex items-center gap-2">
                <label class="text-xs text-gray-500">åˆ†çµ„:</label>
                <select id="chartGroupBy" class="input-field text-xs py-1" onchange="updateChart()">
                    <option value="day">ä¾æ—¥æœŸ (æ—¥)</option>
                    <option value="month">ä¾æœˆä»½ (æœˆ)</option>
                    <option value="year">ä¾å¹´ä»½ (å¹´)</option>
                </select>
            </div>
        </div>

        <div style="position: relative; height: 300px; width: 100%;">
            <canvas id="mainChart"></canvas>
        </div>
    </div>

    <div class="mb-8">
        <h3 class="text-xs font-bold text-gray-500 mb-2 uppercase pl-1">å€é–“æ˜ç´°</h3>
        <div id="historyList" class="rounded-xl overflow-hidden border border-[#2a2d36]"></div>
    </div>

    <div class="footer-credit">
        <div>UberEat å¤–é€è–ªè³‡è¨ˆç®—å™¨ V1.2.17 (History Icon Optimized)</div>
        <div class="mt-1">Developed by Ray Â© 2025</div>
        <div class="mt-1 text-xs text-gray-600">All Rights Reserved.</div>
    </div>

<script>
// === V1.2.8 ä¿®æ­£ç‰ˆï¼šFirebase é…ç½®èˆ‡åˆå§‹åŒ– (æœ€ç©©å®šçš„çµæ§‹) ===
// âš ï¸ è«‹å‹™å¿…ç¢ºèªé€™å€‹ API Key æ˜¯æ‚¨å°ˆæ¡ˆçš„æœ‰æ•ˆå¯†é‘°ï¼
const firebaseConfig = {
    apiKey: "AIzaSyAqiTFbvsIkUVUrBmwaR28448EFMg4FO-w", // æ‚¨çš„ Key
    authDomain: "uber-driver-tracker.firebaseapp.com",
    projectId: "uber-driver-tracker", 
    storageBucket: "uber-driver-tracker.appspot.com",
    messagingSenderId: "333010467554",
    appId: "1:333010467554:web:86f6a5067253fa433878b2"
};

let db; // å…¨åŸŸè®Šæ•¸ç”¨æ–¼ Firestore å­˜å–
let firebaseUnsubscribe = null; // V1.2.12: ç”¨ä¾†å„²å­˜å¯¦æ™‚ç›£è½çš„å–æ¶ˆå‡½å¼

// ğŸ’¡ ä¿®æ­£ï¼šç§»é™¤å¤šé¤˜çš„ projectId æª¢æŸ¥ï¼Œåªæª¢æŸ¥ SDK æ˜¯å¦è¼‰å…¥ä¸” Key æ˜¯å¦å­˜åœ¨
if (typeof firebase !== 'undefined' && firebaseConfig.apiKey) {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    console.log("Firebase åˆå§‹åŒ–æˆåŠŸã€‚");
} else {
    // å¦‚æœå› ç‚ºæŸäº›åŸå› å°è‡´åˆå§‹åŒ–å¤±æ•— (ä¾‹å¦‚ SDK è¼‰å…¥å•é¡Œæˆ–é…ç½®éŒ¯èª¤)
    console.error("Firebase SDK è¼‰å…¥å¤±æ•—æˆ–é…ç½®éŒ¯èª¤ã€‚é›²ç«¯åŒæ­¥åŠŸèƒ½å°‡ä¸æœƒå•Ÿç”¨ã€‚");
}


// === è®Šæ•¸èˆ‡åˆå§‹åŒ– ===
const workerAPI = "https://ubereat-oil-proxy.leo3026772.workers.dev/";
let globalOilPrice = 30.0;
let currentFilter = 'day';
let chartInstance = null;
let chartType = 'bar'; 

window.onload = async () => {
    // V1.2.13: å„ªå…ˆè¼‰å…¥æ”¶åˆç‹€æ…‹ï¼Œç¢ºä¿ UI æ­£ç¢ºé¡¯ç¤º
    loadCollapseStates(); 
    
    resetEditor();
    loadSettings();
    
    const today = getLocalDateString();
    
    // åˆå§‹åŒ–è‡ªå®šç¾©ç¯©é¸å™¨æ—¥æœŸç‚ºä»Šå¤©
    document.getElementById('filterStart').value = today;
    document.getElementById('filterEnd').value = today;

    // åˆå§‹åŒ–åœ–è¡¨æ—¥æœŸç¯„åœ
    const now = new Date();
    document.getElementById('chartStart').value = new Date(now.getFullYear(), 0, 1).toISOString().slice(0,10);
    document.getElementById('chartEnd').value = today;

    // å•Ÿå‹• Firebase ç™»å…¥ç‹€æ…‹ç›£è½ (V1.2.12: æ›¿æ›ç‚ºå¯¦æ™‚ç›£è½é‚è¼¯)
    if (typeof firebase !== 'undefined' && firebaseConfig.apiKey) {
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                // ä½¿ç”¨è€…å·²ç™»å…¥
                document.getElementById('authStatusText').innerText = "å·²ç™»å…¥"; 
                document.getElementById('userEmailDisplay').innerText = user.email;
                document.getElementById('authForm').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                
                // V1.2.12: å•Ÿç”¨å¯¦æ™‚ç›£è½
                setupRealtimeListener(user);

            } else {
                // ä½¿ç”¨è€…å·²ç™»å‡º
                document.getElementById('authStatusText').innerText = "æœªç™»å…¥"; 
                document.getElementById('authForm').classList.remove('hidden');
                document.getElementById('userInfo').classList.add('hidden');
                
                // V1.2.12: å–æ¶ˆå¯¦æ™‚ç›£è½ (å¦‚æœæœ‰çš„è©±)
                if (firebaseUnsubscribe) {
                    firebaseUnsubscribe();
                    firebaseUnsubscribe = null;
                }
                
                // ç™»å‡ºå¾Œï¼Œé¡¯ç¤ºæœ¬åœ°è³‡æ–™
                refreshDashboard(); 
            }
        });
    } else {
        refreshDashboard();
    }
    
    await fetchOil
