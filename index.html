<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uber Driver æ·¨åˆ©è¨ˆç®— V8.1</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Chart.js (ç”¨æ–¼åœ“é¤…åœ–) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- è¼‰å…¥ Chart.js Datalabels Plugin (ç”¨æ–¼åœ“é¤…åœ–å…§é¡¯ç¤ºæ•¸å€¼) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp, setDoc, doc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- æ ¸å¿ƒå¸¸æ•¸ (é è¨­å€¼) ---
        const DEFAULT_FUEL_EFFICIENCY_KML = 42;  
        const DEFAULT_MAINT_COST_PER_KM = 0.60;  

        // --- ç‹€æ…‹è®Šæ•¸ ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;
        let isAuthReady = false;
        
        // App æ ¸å¿ƒç‹€æ…‹
        let currentOilPrice = 30.0;
        let chartInstance = null; // åœ“é¤…åœ–å¯¦ä¾‹
        let userConfig = {
            fuelEfficiency: DEFAULT_FUEL_EFFICIENCY_KML,
            maintCostPerKm: DEFAULT_MAINT_COST_PER_KM
        };
        let currentViewDate = new Date(); // å ±è¡¨ç€è¦½åŸºæº–æ—¥
        let currentReportPeriod = 'day'; 

        setLogLevel('debug');

        // --- Firebase åˆå§‹åŒ–èˆ‡èªè­‰ ---
        const configDocPath = (uid) => `artifacts/${appId}/users/${uid}/config/costs`;

        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    isAuthReady = true;
                    document.getElementById('loading-overlay').classList.add('hidden');
                    document.getElementById('user-info').textContent = `ID: ${userId}`;
                    window.db = db;
                    window.userId = userId;
                    
                    await loadConfig(); 
                    await fetchOilPrice(true); // é¦–æ¬¡è¼‰å…¥æ™‚è‡ªå‹•ç²å–æ²¹åƒ¹
                    window.initApp(); 
                    
                } else if (!isAuthReady) {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                }
            });
        } catch (error) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", error);
            document.getElementById('loading-text').textContent = "é›²ç«¯åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®šã€‚";
        }

        // --- è¨­å®šæª”è®€å¯« ---
        async function loadConfig() {
            if (!db || !userId) return;

            onSnapshot(doc(db, configDocPath(userId)), (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    userConfig.fuelEfficiency = data.fuelEfficiency || DEFAULT_FUEL_EFFICIENCY_KML;
                    userConfig.maintCostPerKm = data.maintCostPerKm || DEFAULT_MAINT_COST_PER_KM;
                }
                updateConfigUI(); 
                liveCalculate(); 
            }, (error) => {
                console.error("è¼‰å…¥é…ç½®å¤±æ•—:", error);
                updateConfigUI(); 
            });
        }

        window.saveConfig = async function() {
            if (!db || !userId) {
                showMessage("é›²ç«¯å°šæœªé€£ç·šã€‚", 'error');
                return;
            }
            
            const fuel = parseFloat(document.getElementById('fuelEfficiencyInput').value);
            const maint = parseFloat(document.getElementById('maintCostInput').value);

            if (isNaN(fuel) || isNaN(maint) || fuel <= 0 || maint < 0) {
                 showMessage("è«‹è¼¸å…¥æœ‰æ•ˆçš„åƒæ•¸å€¼ã€‚", 'error');
                 updateConfigUI(); 
                 return;
            }

            userConfig.fuelEfficiency = fuel;
            userConfig.maintCostPerKm = maint;

            try {
                await setDoc(doc(db, configDocPath(userId)), userConfig, { merge: true });
                showMessage("è¨­å®šå·²å„²å­˜åˆ°é›²ç«¯ï¼", 'success');
                liveCalculate(); 
            } catch (e) {
                console.error("å„²å­˜é…ç½®å¤±æ•—:", e);
                showMessage("å„²å­˜è¨­å®šåˆ°é›²ç«¯å¤±æ•—", 'error');
            }
        }

        function updateConfigUI() {
            document.getElementById('fuelEfficiencyInput').value = userConfig.fuelEfficiency;
            document.getElementById('maintCostInput').value = userConfig.maintCostPerKm;
            document.getElementById('fuelEfficiencyDisplay').textContent = `${userConfig.fuelEfficiency} km/L`;
            document.getElementById('maintCostDisplay').textContent = `$${userConfig.maintCostPerKm.toFixed(2)}/km`;
        }

        /**
         * è¼”åŠ©å‡½æ•¸ï¼šå°‡å°æ•¸æ™‚æ•¸è½‰æ›ç‚º H å°æ™‚ M åˆ†é˜æ ¼å¼
         * @param {number} decimalHours - ç¸½å°æ™‚æ•¸ (å«å°æ•¸, e.g., 8.5)
         * @returns {string} - H å°æ™‚ M åˆ†é˜ (e.g., "8 å°æ™‚ 30 åˆ†")
         */
        function formatHours(decimalHours) {
            if (isNaN(decimalHours) || decimalHours === 0) return '0 å°æ™‚ 0 åˆ†';
            const hours = Math.floor(decimalHours);
            const minutes = Math.round((decimalHours - hours) * 60);
            return `${hours} å°æ™‚ ${minutes} åˆ†`;
        }
        
        // --- å³æ™‚è¨ˆç®—åŠŸèƒ½ ---
        window.liveCalculate = function() {
            // è®€å–è¼¸å…¥å€¼
            const income = parseFloat(document.getElementById('income').value) || 0;
            const km = parseFloat(document.getElementById('mileage').value) || 0; 
            const hours = parseFloat(document.getElementById('hours').value) || 0;
            const minutes = parseFloat(document.getElementById('minutes').value) || 0;
            const totalHours = hours + (minutes / 60);

            const fuelEff = userConfig.fuelEfficiency || DEFAULT_FUEL_EFFICIENCY_KML;
            const maintCostPerKm = userConfig.maintCostPerKm || DEFAULT_MAINT_COST_PER_KM;

            // æˆæœ¬è¨ˆç®—
            const gasCost = (km / fuelEff) * currentOilPrice;
            const maintCost = km * maintCostPerKm;
            const totalCost = gasCost + maintCost;
            const netProfit = income - totalCost;

            // æ™‚è–ªè¨ˆç®—
            let grossHourlyRate = 0;
            let netHourlyRate = 0;
            if (totalHours > 0) {
                grossHourlyRate = income / totalHours;
                netHourlyRate = netProfit / totalHours;
            }

            // æ›´æ–° UI æ•¸å€¼
            document.getElementById('liveGrossIncome').textContent = `$${income.toFixed(1)}`; 
            document.getElementById('liveGasCost').textContent = `$${gasCost.toFixed(1)}`;
            document.getElementById('liveMaintCost').textContent = `$${maintCost.toFixed(1)}`;
            document.getElementById('liveNetProfit').textContent = `$${netProfit.toFixed(1)}`;
            document.getElementById('liveTotalCost').textContent = `$${totalCost.toFixed(1)}`;

            // æ™‚è–ªé¡¯ç¤º
            document.getElementById('liveGrossHourly').textContent = `$${grossHourlyRate.toFixed(1)}/hr`;
            document.getElementById('liveNetHourly').textContent = `$${netHourlyRate.toFixed(1)}/hr`;

            // èª¿æ•´æ·¨åˆ©é¡è‰²
            document.getElementById('liveNetProfit').classList.toggle('net-profit', netProfit >= 0);
            document.getElementById('liveNetProfit').classList.toggle('cost-val', netProfit < 0);
            document.getElementById('liveNetHourly').classList.toggle('net-profit', netHourlyRate >= 0);
            document.getElementById('liveNetHourly').classList.toggle('cost-val', netHourlyRate < 0);
        }

        // --- å‹•æ…‹æ²¹åƒ¹ç²å– (ä½¿ç”¨ Google Search) ---
        window.fetchOilPrice = async function(isInitial = false) {
            const button = document.getElementById('fetchOilPriceButton');
            const display = document.getElementById('oilPriceDisplay');
            
            button.disabled = true;
            display.textContent = 'ç²å–ä¸­...';

            // èª¿æ•´æŸ¥è©¢ä»¥ç¢ºä¿è¿”å›ç´”æ•¸å­—
            const userQuery = "å°ç£ä¸­æ²¹ 92 ç„¡é‰›æ±½æ²¹ ä»Šæ—¥æ¯å…¬å‡åƒ¹æ ¼ï¼Œåªéœ€è¦çµ¦æˆ‘æ•¸å­—ï¼Œä¸è¦ä»»ä½•æ–‡å­—ã€ç¬¦è™Ÿæˆ–å–®ä½ã€‚";
            const apiKey = "" // Leave as-is
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
            };
            
            try {
                let response = null;
                let result = null;
                let retries = 0;
                const maxRetries = 3;

                while (retries < maxRetries) {
                    const delay = Math.pow(2, retries) * 1000;
                    if (retries > 0) await new Promise(resolve => setTimeout(resolve, delay));

                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        result = await response.json();
                        break;
                    }
                    retries++;
                }
                
                if (!response.ok || !result) throw new Error("API å‘¼å«å¤±æ•—æˆ–çµæœç‚ºç©ºï¼Œå·²é”æœ€å¤§é‡è©¦æ¬¡æ•¸ã€‚");

                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || '';
                
                // å¼·åŒ–è§£æï¼šæå–æ–‡æœ¬ä¸­æ‰€æœ‰æ•¸å­—å’Œå°æ•¸é»ï¼Œçµ„æˆä¸€å€‹æ•¸å­—
                const priceMatch = text.match(/[\d.]+/g);
                const price = priceMatch ? parseFloat(priceMatch.join('')) : NaN;
                
                if (!isNaN(price) && price > 0) {
                    currentOilPrice = price;
                    display.textContent = `$${price.toFixed(2)}/L`;
                    if (!isInitial) showMessage("æ²¹åƒ¹æ›´æ–°æˆåŠŸï¼", 'success');
                } else {
                    throw new Error("æœªèƒ½å¾çµæœä¸­è§£æå‡ºæœ‰æ•ˆåƒ¹æ ¼: " + text);
                }

            } catch (error) {
                console.error("ç²å–æ²¹åƒ¹ç™¼ç”ŸéŒ¯èª¤:", error);
                display.textContent = `$${currentOilPrice.toFixed(2)}/L (æ›´æ–°å¤±æ•—ï¼Œä½¿ç”¨æ­¤å€¼)`;
                if (!isInitial) showMessage("æ²¹åƒ¹æ›´æ–°å¤±æ•—ï¼Œè«‹æŸ¥çœ‹ Console éŒ¯èª¤è¨Šæ¯", 'error');
            } finally {
                button.disabled = false;
                liveCalculate(); 
            }
        }

        // --- å„²å­˜ç´€éŒ„ ---
        window.addRecord = async function() {
            // è®€å–è¼¸å…¥å€¼
            const date = document.getElementById('entryDate').value;
            const income = parseFloat(document.getElementById('income').value) || 0;
            const km = parseFloat(document.getElementById('mileage').value) || 0;
            const hours = parseFloat(document.getElementById('hours').value) || 0;
            const minutes = parseFloat(document.getElementById('minutes').value) || 0;
            const totalHours = hours + (minutes / 60);

            // V8.1 å¼·åŒ–é©—è­‰ï¼šæä¾›æ›´æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
            if (!isAuthReady) {
                showMessage("â›” é›²ç«¯æœå‹™å°šæœªé€£ç·šå®Œæˆï¼Œè«‹ç­‰å¾… ID é¡¯ç¤ºå¾Œå†è©¦ã€‚", 'error');
                return;
            }
            if (!date) {
                showMessage("â›” éŒ¯èª¤ï¼šè«‹é¸æ“‡æ—¥æœŸã€‚", 'error');
                return;
            }
            if (km === 0) {
                showMessage("â›” éŒ¯èª¤ï¼šé¨ä¹˜å…¬é‡Œæ•¸å¿…é ˆå¤§æ–¼é›¶ã€‚", 'error');
                return;
            }
            if (totalHours === 0) {
                showMessage("â›” éŒ¯èª¤ï¼šç¸½å·¥ä½œæ™‚æ•¸å¿…é ˆå¤§æ–¼é›¶ã€‚", 'error');
                return;
            }


            const fuelEff = userConfig.fuelEfficiency;
            const maintCostPerKm = userConfig.maintCostPerKm;
            const gasCost = (km / fuelEff) * currentOilPrice;
            const maintCost = km * maintCostPerKm;
            const netProfit = income - gasCost - maintCost;

            const record = {
                date: date,
                income: income,
                gasCost: parseFloat(gasCost.toFixed(2)),
                km: parseFloat(km.toFixed(1)), // å„²å­˜å…¬é‡Œæ•¸ï¼Œä¿ç•™ä¸€ä½å°æ•¸
                maintCost: parseFloat(maintCost.toFixed(2)),
                net: parseFloat(netProfit.toFixed(2)),
                totalHours: parseFloat(totalHours.toFixed(2)), // å„²å­˜ç¸½æ™‚æ•¸
                oilPriceUsed: currentOilPrice,
                configSnapshot: { fuelEff, maintCostPerKm }, 
                timestamp: serverTimestamp()
            };

            try {
                const collectionPath = `artifacts/${appId}/users/${userId}/uber_records`;
                await addDoc(collection(db, collectionPath), record);
                
                // æ¸…ç©ºè¼¸å…¥ï¼Œä¿ç•™æ—¥æœŸ
                document.getElementById('income').value = '';
                document.getElementById('mileage').value = '';
                document.getElementById('hours').value = '';
                document.getElementById('minutes').value = '';
                liveCalculate(); 
                
                const netHourlyRate = netProfit / totalHours;
                showMessage(`âœ… æ–°å¢æˆåŠŸï¼æ·¨åˆ©: $${netProfit.toFixed(1)}ï¼Œæ™‚è–ª: $${netHourlyRate.toFixed(1)}`, 'success');

            } catch (e) {
                console.error("æ–°å¢ç´€éŒ„å¤±æ•—: ", e);
                showMessage("âŒ å„²å­˜åˆ°é›²ç«¯å¤±æ•—ï¼Œè«‹æŸ¥çœ‹ console éŒ¯èª¤è¨Šæ¯", 'error');
            }
        }

        // --- Firestore è³‡æ–™ç›£è½ ---
        window.initApp = function() {
            if (!db || !userId) return;

            const collectionPath = `artifacts/${appId}/users/${userId}/uber_records`;
            const q = query(collection(db, collectionPath));
            
            onSnapshot(q, (querySnapshot) => {
                const records = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    records.push({ id: doc.id, ...data });
                });
                records.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                window.allRecords = records;
                renderReport(currentReportPeriod, currentViewDate); 
            }, (error) => {
                console.error("å³æ™‚ç›£è½è³‡æ–™å¤±æ•—:", error);
                showMessage("é€£ç·šè³‡æ–™åº«å¤±æ•—ï¼Œè«‹é‡æ•´é é¢", 'error');
            });

            document.getElementById('entryDate').valueAsDate = new Date();
        }
        
        // --- å ±è¡¨å°èˆªèˆ‡æ¸²æŸ“ ---
        
        function getPeriodBoundary(period, date) {
            const start = new Date(date);
            start.setHours(0, 0, 0, 0);
            
            let endDate = new Date(start);

            if (period === 'day') {
                // é–‹å§‹å’ŒçµæŸéƒ½æ˜¯ç•¶å¤©
            } else if (period === 'week') {
                const day = start.getDay(); 
                const diff = day === 0 ? -6 : 1 - day; 
                start.setDate(start.getDate() + diff); 
                
                endDate = new Date(start);
                endDate.setDate(endDate.getDate() + 6); 
            } else if (period === 'month') {
                start.setDate(1);
                
                endDate = new Date(start.getFullYear(), start.getMonth() + 1, 0); 
            } else if (period === 'year') {
                start.setMonth(0, 1);
                
                endDate = new Date(start.getFullYear(), 11, 31);
            }

            endDate.setHours(23, 59, 59, 999);
            return { start, end: endDate };
        }
        
        // å°èˆªå‡½æ•¸ (é»æ“Šç®­é ­)
        window.navigateReport = function(direction) {
            const date = currentViewDate;
            const period = currentReportPeriod;

            let newDate = new Date(date);

            if (period === 'day') {
                newDate.setDate(date.getDate() + direction);
            } else if (period === 'week') {
                newDate.setDate(date.getDate() + (direction * 7));
            } else if (period === 'month') {
                newDate.setMonth(date.getMonth() + direction);
            } else if (period === 'year') {
                newDate.setFullYear(date.getFullYear() + direction);
            }
            
            currentViewDate = newDate;
            renderReport(period, newDate);
        }

        // é ç±¤åˆ‡æ›é‚è¼¯
        window.switchTab = function(period) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active', 'text-black'));
            document.getElementById(`tab-${period}`).classList.add('active', 'text-black');
            currentReportPeriod = period;
            currentViewDate = new Date(); // åˆ‡æ›æ™‚ï¼Œé è¨­å›åˆ°ä»Šå¤©/æœ¬é€±/æœ¬æœˆ
            renderReport(period, currentViewDate);
        }
        
        // åœ“é¤…åœ–ç¹ªè£½
        function drawPieChart(totalNet, totalGasCost, totalMaintCost) {
            const ctx = document.getElementById('netProfitChart');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            // è™•ç†è² æ·¨åˆ©ï¼šåœ“é¤…åœ–ç„¡æ³•é¡¯ç¤ºè² å€¼ï¼Œè‹¥ç‚ºè² ï¼Œå°‡æ·¨åˆ©è¦–ç‚º 0
            const displayNet = Math.max(0, totalNet); 
            
            const totalSum = displayNet + totalGasCost + totalMaintCost;
            
            if (totalSum === 0) {
                 ctx.style.display = 'none';
                 return;
            } else {
                 ctx.style.display = 'block';
            }
            
            const chartData = {
                labels: ['å¯¦é ˜æ·¨åˆ©', 'æ²¹è²»æˆæœ¬', 'è€—ææˆæœ¬'],
                datasets: [{
                    data: [displayNet, totalGasCost, totalMaintCost],
                    backgroundColor: ['#10B981', '#3B82F6', '#EF4444'],
                    hoverOffset: 8
                }]
            };

            chartInstance = new Chart(ctx.getContext('2d'), {
                type: 'pie',
                data: chartData,
                plugins: [ChartDataLabels], // è¨»å†Š Datalabels å¤–æ›
                options: {
                    responsive: true,
                    layout: {
                        padding: 35 // å¢åŠ åœ–è¡¨é‚Šè·ä»¥å®¹ç´å¤–éƒ¨å¼•ç·šæ¨™ç±¤
                    },
                    plugins: {
                        legend: { position: 'top', labels: { font: { size: 12 } } },
                        title: {
                            display: true,
                            text: 'ç¸½æ”¶å…¥åˆ†é… (é‡‘é¡èˆ‡ %)',
                            font: { size: 14, weight: 'bold' }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = (value / total * 100).toFixed(1) + '%';
                                    return `${label}: $${Math.round(value).toLocaleString()} (${percentage})`;
                                }
                            }
                        },
                        // *** Datalabels Configuration - ä¿®æ­£é‡ç–Šå•é¡Œï¼Œåƒ…é¡¯ç¤ºç™¾åˆ†æ¯” ***
                        datalabels: {
                            color: '#4B5563', // ä½¿ç”¨æ·±ç°è‰²æ–‡å­—
                            formatter: (value, context) => {
                                const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                const percentage = (value / total * 100).toFixed(1);
                                
                                // ä¿®æ­£é‡ç–Šå•é¡Œï¼šåƒ…é¡¯ç¤ºç™¾åˆ†æ¯”ï¼Œå®Œæ•´çš„é‡‘é¡èˆ‡ç™¾åˆ†æ¯”åœ¨ Tooltip ä¸­é¡¯ç¤º
                                return percentage + '%'; 
                            },
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            // å•Ÿç”¨ Lines æ¨¡å¼
                            anchor: 'end', 
                            align: 'start', // æ–‡æœ¬å¾å¼•ç·šæœ«ç«¯é–‹å§‹
                            offset: 10, // æ¨™ç±¤èˆ‡å¼•ç·šçš„è·é›¢
                            // ä½¿ç”¨ Clamp å±¬æ€§ï¼Œç¢ºä¿æ¨™ç±¤ä¸æœƒè¶…å‡ºåœ–è¡¨é‚Šç•Œ
                            clamp: true,
                            // è¨­å®šå¼•ç·šæ¨£å¼
                            listeners: {
                                afterDraw: (context) => {
                                    const { chart } = context;
                                    const ctx = chart.ctx;
                                    
                                    // ç¹ªè£½å¼•ç·š (Line)
                                    context.line.lineWidth = 1;
                                    context.line.strokeStyle = '#9CA3AF'; // ç°è‰²å¼•ç·š
                                    context.line.setContext(ctx);
                                    context.line.draw();
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ ¸å¿ƒæ¸²æŸ“å‡½æ•¸
        function renderReport(period, date) {
            const records = window.allRecords || [];
            const { start, end } = getPeriodBoundary(period, date);
            
            let totalIncome = 0;
            let totalGasCost = 0;
            let totalMaintCost = 0;
            let totalNet = 0;
            let totalKm = 0;
            let totalHours = 0; // ç¸½å·¥ä½œæ™‚æ•¸
            let filteredRecords = [];

            records.forEach(r => {
                const recordDate = new Date(r.date);
                if (recordDate >= start && recordDate <= end) {
                    totalIncome += r.income;
                    totalGasCost += r.gasCost || 0;
                    totalMaintCost += r.maintCost || 0;
                    totalNet += r.net;
                    totalKm += r.km;
                    totalHours += r.totalHours || 0; // ç´¯åŠ ç¸½æ™‚æ•¸
                    filteredRecords.push(r);
                }
            });
            
            const totalCost = totalGasCost + totalMaintCost;
            
            // è¨ˆç®—å¹³å‡æ™‚è–ª
            let avgGrossHourlyRate = 0; // <-- æ¯›åˆ©æ™‚è–ª
            let avgNetHourlyRate = 0;
            if (totalHours > 0) {
                avgGrossHourlyRate = totalIncome / totalHours; // ç‡Ÿæ¥­é¡ / ç¸½å·¥æ™‚
                avgNetHourlyRate = totalNet / totalHours;
            }
            
            // è½‰æ›ç¸½æ™‚æ•¸æ ¼å¼
            const formattedTotalTime = formatHours(totalHours);
            
            // æ›´æ–°å°èˆªæ¨™é¡Œ
            let dateStr;
            if (period === 'day') {
                dateStr = start.toLocaleDateString('zh-TW', { year: 'numeric', month: 'numeric', day: 'numeric' });
            } else if (period === 'week') {
                const endStr = end.toLocaleDateString('zh-TW', { month: 'numeric', day: 'numeric' });
                dateStr = `${start.toLocaleDateString('zh-TW', { month: 'numeric', day: 'numeric' })} - ${endStr}`;
            } else if (period === 'month') {
                dateStr = start.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long' });
            } else if (period === 'year') {
                dateStr = start.toLocaleDateString('zh-TW', { year: 'numeric' });
            }
            document.getElementById('report-title-text').textContent = dateStr; 

            // æ¸²æŸ“å ±è¡¨ HTML (ä½¿ç”¨ 7 å€‹é …ç›®ï¼Œç¸½é‡Œç¨‹ä½”ç”¨å…©æ¬„)
            const html = `
                <!-- åœ“é¤…åœ–ç¹ªè£½ Canvas -->
                <div class="mb-6 p-4 border rounded-xl shadow-inner">
                    <canvas id="netProfitChart" class="max-h-64"></canvas>
                </div>

                <!-- ç¸½çµæ•¸æ“š (4x2 Grid + 1 Spanning Item) -->
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <!-- 1. ç¸½æ”¶å…¥ -->
                    <div class="p-3 bg-gray-100 rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">ç¸½æ”¶å…¥ (æœŸé–“)</p>
                        <p class="text-xl font-bold mt-1 text-black">$${Math.round(totalIncome).toLocaleString()}</p>
                    </div>

                    <!-- 2. å¯¦é ˜æ·¨åˆ© -->
                    <div class="p-3 ${totalNet >= 0 ? 'bg-green-50' : 'bg-red-50'} rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">å¯¦é ˜æ·¨åˆ©</p>
                        <p class="text-xl font-bold mt-1 ${totalNet >= 0 ? 'net-profit' : 'cost-val'}">$${Math.round(totalNet).toLocaleString()}</p>
                    </div>
                    
                    <!-- 3. ç¸½èŠ±è²»æ™‚é–“ -->
                    <div class="p-3 bg-yellow-50 rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">ç¸½èŠ±è²»æ™‚é–“</p>
                        <p class="text-xl font-bold mt-1 text-yellow-700">${formattedTotalTime}</p>
                    </div>

                    <!-- 4. ç¸½æ¶ˆè€—æˆæœ¬ -->
                    <div class="p-3 bg-red-50 rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">ç¸½æ¶ˆè€—æˆæœ¬</p>
                        <p class="text-xl font-bold mt-1 cost-val">$${Math.round(totalCost).toLocaleString()}</p>
                    </div>
                    
                    <!-- 5. å¹³å‡æ™‚è–ª (æ¯›åˆ©) -->
                    <div class="p-3 bg-indigo-50 rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">å¹³å‡æ™‚è–ª (æ¯›åˆ©)</p>
                        <p class="text-xl font-bold mt-1 text-indigo-700">$${Math.round(avgGrossHourlyRate).toLocaleString()}/hr</p>
                    </div>

                    <!-- 6. å¹³å‡æ™‚è–ª (æ·¨åˆ©) -->
                    <div class="p-3 ${avgNetHourlyRate >= 0 ? 'bg-green-50' : 'bg-red-50'} rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">å¹³å‡æ™‚è–ª (æ·¨åˆ©)</p>
                        <p class="text-xl font-bold mt-1 ${avgNetHourlyRate >= 0 ? 'net-profit' : 'cost-val'}">$${Math.round(avgNetHourlyRate).toLocaleString()}/hr</p>
                    </div>
                    
                    <!-- 7. ç¸½é‡Œç¨‹ (ä½”ç”¨å…©æ¬„ï¼Œç¢ºä¿æ’ç‰ˆæ•´é½Š) -->
                    <div class="col-span-2 p-3 bg-gray-100 rounded-lg shadow-sm">
                        <p class="text-xs font-medium text-gray-500">ç¸½é‡Œç¨‹ (km)</p>
                        <p class="text-xl font-bold mt-1 text-gray-800">${totalKm.toFixed(1).toLocaleString()}</p>
                    </div>
                    
                </div>
                
                <!-- æ˜ç´°åˆ—è¡¨ -->
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <p class="text-sm font-semibold mb-2">æœŸé–“ç´€éŒ„æ˜ç´°:</p>
                    <div id="history-list" class="max-h-48 overflow-y-auto space-y-2">
                        ${filteredRecords.length > 0 ? filteredRecords.map(r => `
                            <div class="text-xs p-2 border rounded-md bg-gray-50 flex justify-between items-center">
                                <div class="w-1/3">
                                    <span class="font-bold">${r.date}</span>
                                    <span class="text-gray-500 ml-1">(${formatHours(r.totalHours)})</span>
                                </div>
                                <div class="text-right w-2/3">
                                    <span class="font-medium text-gray-500">æˆæœ¬: $${(r.gasCost + r.maintCost).toFixed(0)}</span>
                                    <span class="font-bold ${r.net >= 0 ? 'net-profit' : 'cost-val'} ml-2">æ·¨åˆ©: $${r.net.toFixed(0)}</span>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center text-gray-500 py-4">æ­¤æœŸé–“å°šç„¡ç´€éŒ„ã€‚</p>'}
                    </div>
                </div>
            `;
            document.getElementById('report-area').innerHTML = html;
            
            // ç¹ªè£½åœ“é¤…åœ– (å¿…é ˆåœ¨ canvas å…ƒç´ è¢«æ·»åŠ åˆ° DOM å¾ŒåŸ·è¡Œ)
            drawPieChart(totalNet, totalGasCost, totalMaintCost);
        }

        // --- æ—¥æœŸé¸æ“‡ Modal é‚è¼¯ ---
        
        window.openDateSelector = function() {
            document.getElementById('date-selector-modal').classList.remove('hidden');
            const period = currentReportPeriod;
            // æ ¹æ“šç•¶å‰å ±è¡¨é¡å‹ï¼Œé¡¯ç¤ºæˆ–éš±è—ç‰¹å®šçš„è¼¸å…¥æ¡†
            document.querySelectorAll('.date-modal-input').forEach(el => el.classList.add('hidden'));
            document.getElementById(`modal-${period}-group`).classList.remove('hidden');

            // åˆå§‹åŒ–è¼¸å…¥æ¡†çš„å€¼ç‚ºç•¶å‰æ—¥æœŸ
            const dateStr = currentViewDate.toISOString().substring(0, 10);
            if (period === 'day' || period === 'week') {
                document.getElementById(`modal-${period}-input`).value = dateStr;
            } else if (period === 'month') {
                document.getElementById('modal-month-input').value = dateStr.substring(0, 7);
            } else if (period === 'year') {
                document.getElementById('modal-year-input').value = currentViewDate.getFullYear();
            }
        }

        window.closeDateSelector = function() {
            document.getElementById('date-selector-modal').classList.add('hidden');
        }

        window.jumpToDate = function() {
            const period = currentReportPeriod;
            let newDate = new Date(); // é è¨­ç‚ºä»Šå¤©

            try {
                if (period === 'day' || period === 'week') {
                    const dateInput = document.getElementById(`modal-${period}-input`).value;
                    if (dateInput) newDate = new Date(dateInput);
                } else if (period === 'month') {
                    const monthYear = document.getElementById('modal-month-input').value; // YYYY-MM
                    const parts = monthYear.split('-');
                    if (parts.length === 2) {
                        newDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, 1);
                    } else {
                         throw new Error("æœˆä»½æ ¼å¼éŒ¯èª¤");
                    }
                } else if (period === 'year') {
                    const year = document.getElementById('modal-year-input').value;
                    const yearNum = parseInt(year);
                    if (!isNaN(yearNum)) {
                         newDate = new Date(yearNum, 0, 1);
                    } else {
                         throw new Error("å¹´ä»½æ ¼å¼éŒ¯èª¤");
                    }
                }
            } catch (e) {
                showMessage("æ—¥æœŸè¼¸å…¥æ ¼å¼ä¸æ­£ç¢ºï¼", 'error');
                return;
            }
            
            currentViewDate = newDate;
            renderReport(period, newDate);
            closeDateSelector();
        }
        
        // --- é€šç”¨ UI å‡½æ•¸ ---
        
        function showMessage(msg, type = 'success') {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = msg;
            msgBox.className = `fixed bottom-5 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg text-white text-sm z-50 transition-opacity duration-300 ${type === 'error' ? 'bg-red-600' : 'bg-green-600'}`;
            msgBox.classList.remove('opacity-0');
            setTimeout(() => {
                msgBox.classList.add('opacity-0');
            }, 4000); // å»¶é•·é¡¯ç¤ºæ™‚é–“ç‚º 4 ç§’
        }
        
        // åˆå§‹è¼‰å…¥
        window.onload = function() {
            liveCalculate(); 
            switchTab('day'); 
        };
        
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab.active { border-bottom: 3px solid #000; color: #000; }
        .net-profit { color: #10B981; }
        .cost-val { color: #EF4444; }
        /* éš±è—åŸç”Ÿæ—¥æœŸè¼¸å…¥æ¡†çš„ç®­é ­ (åƒ…å° Chrome/Safari æœ‰æ•ˆ) */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] { -moz-appearance: textfield; }
        .date-input-group { position: relative; }
        .date-input-group input { padding-right: 3rem; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4">

    <!-- è¨Šæ¯æç¤ºæ¡† (å–ä»£ alert) -->
    <div id="message-box" class="opacity-0"></div>

    <!-- é ‚éƒ¨è³‡è¨Šå’Œè¼‰å…¥ç•«é¢ -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-50 flex flex-col justify-center items-center z-50">
        <svg class="animate-spin h-8 w-8 text-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p id="loading-text" class="mt-4 text-sm text-gray-600">é€£ç·šé›²ç«¯è³‡æ–™åº«èˆ‡æ²¹åƒ¹ä¸­...</p>
    </div>

    <!-- æ—¥æœŸé¸æ“‡ Modal -->
    <div id="date-selector-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs mx-4">
            <h3 class="text-xl font-bold mb-4">ğŸ—“ï¸ è·³è½‰è‡³æŒ‡å®šæ—¥æœŸ</h3>

            <!-- å–®æ—¥/å–®é€± é¸æ“‡ -->
            <div id="modal-day-group" class="date-modal-input hidden mb-4">
                <label class="text-sm font-medium text-gray-700">é¸æ“‡æ—¥æœŸ</label>
                <input type="date" id="modal-day-input" class="w-full mt-1 p-2 border border-gray-300 rounded-lg">
            </div>
            
            <div id="modal-week-group" class="date-modal-input hidden mb-4">
                <label class="text-sm font-medium text-gray-700">é¸æ“‡æ—¥æœŸ (å°‡é¡¯ç¤ºè©²é€±å ±è¡¨)</label>
                <input type="date" id="modal-week-input" class="w-full mt-1 p-2 border border-gray-300 rounded-lg">
            </div>

            <!-- æœˆä»½é¸æ“‡ -->
            <div id="modal-month-group" class="date-modal-input hidden mb-4">
                <label class="text-sm font-medium text-gray-700">é¸æ“‡æœˆä»½</label>
                <!-- æ³¨æ„ï¼šéƒ¨åˆ†ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´ type="month"ï¼Œé€™è£¡ä½¿ç”¨ text æ­é… pattern -->
                <input type="month" id="modal-month-input" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="YYYY-MM" pattern="\d{4}-\d{2}">
            </div>

            <!-- å¹´ä»½é¸æ“‡ -->
            <div id="modal-year-group" class="date-modal-input hidden mb-4">
                <label class="text-sm font-medium text-gray-700">è¼¸å…¥å¹´ä»½</label>
                <input type="number" id="modal-year-input" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="e.g., 2025">
            </div>

            <div class="flex justify-end space-x-3 mt-5">
                <button onclick="closeDateSelector()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition duration-200">
                    å–æ¶ˆ
                </button>
                <button onclick="jumpToDate()" class="px-4 py-2 bg-black text-white font-semibold rounded-lg hover:bg-gray-800 transition duration-200">
                    ç¢ºèªè·³è½‰
                </button>
            </div>
        </div>
    </div>

    <!-- ä¸»é«”å…§å®¹ -->
    <main id="main-content" class="max-w-md mx-auto">
        <h1 class="text-2xl font-bold text-center mb-1">Uber Driver æ·¨åˆ©è¨ˆç®—æ©Ÿ V8.1</h1>
        <p id="user-info" class="text-xs text-gray-500 text-center mb-6">ID: (é€£ç·šä¸­...)</p>

        <!-- 1. æˆæœ¬åƒæ•¸è¨­å®šå€ (å¯æ”¶åˆ) -->
        <details class="bg-white p-5 rounded-xl shadow-md mb-6 transition duration-200">
            <summary class="text-lg font-semibold border-b pb-2 cursor-pointer">âš™ï¸ æˆæœ¬åƒæ•¸è¨­å®š (é›²ç«¯å„²å­˜)</summary>
            
            <div class="mt-4 space-y-3">
                <!-- æ²¹è€—æ•ˆç‡è¨­å®š -->
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <label for="fuelEfficiencyInput" class="text-sm font-medium text-gray-700">æ²¹è€—æ•ˆç‡ (km/L)</label>
                    <input type="number" id="fuelEfficiencyInput" onchange="saveConfig()" 
                           placeholder="42" class="w-20 p-2 text-right border border-gray-300 rounded-lg focus:ring-black focus:border-black text-sm">
                </div>

                <!-- æ¯å…¬é‡Œè€—ææ”¯å‡ºè¨­å®š -->
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <label for="maintCostInput" class="text-sm font-medium text-gray-700">æ¯å…¬é‡Œæ”¯å‡ºè€—æ ($/km)</label>
                    <input type="number" step="0.01" id="maintCostInput" onchange="saveConfig()" 
                           placeholder="0.60" class="w-20 p-2 text-right border border-gray-300 rounded-lg focus:ring-black focus:border-black text-sm">
                </div>

                <p class="text-xs text-gray-500 pt-2 text-center">æ›´æ”¹å¾Œæœƒè‡ªå‹•å„²å­˜è‡³é›²ç«¯ä¸¦å¥—ç”¨æ–¼æ‰€æœ‰è¨ˆç®—ã€‚</p>
            </div>
        </details>

        <!-- 2. æ–°å¢ç´€éŒ„å€ -->
        <div class="bg-white p-5 rounded-xl shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-4 border-b pb-2">âœï¸ ç•¶æ—¥æ•¸æ“šè¼¸å…¥</h2>
            
            <!-- æ²¹åƒ¹é¡¯ç¤ºèˆ‡æ›´æ–° -->
            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex justify-between items-center">
                <div>
                    <span class="text-xs text-gray-600">ä¸­æ²¹ 92 æ±½æ²¹ï¼š</span>
                    <span id="oilPriceDisplay" class="font-bold text-blue-700">$30.00/L (é è¨­)</span>
                    <p class="text-xs text-gray-500 mt-1">ç›®å‰æ²¹è€—ä¿‚æ•¸ï¼š<span id="fuelEfficiencyDisplay">42 km/L</span>ï¼Œè€—æï¼š<span id="maintCostDisplay">$0.60/km</span></p>
                </div>
                <button id="fetchOilPriceButton" onclick="fetchOilPrice()" class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold py-2 px-3 rounded-lg transition duration-200">
                    æ›´æ–°æ²¹åƒ¹
                </button>
            </div>

            <div class="mb-3">
                <label for="entryDate" class="text-sm font-medium text-gray-700">ğŸ“… æ—¥æœŸ</label>
                <input type="date" id="entryDate" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black">
            </div>
            
            <div class="mb-3">
                <label for="income" class="text-sm font-medium text-gray-700">ğŸ’° ç•¶æ—¥ç‡Ÿæ¥­é¡ (å¯¦æ”¶/æœªæ‰£)</label>
                <input type="number" id="income" placeholder="è¼¸å…¥é‡‘é¡" oninput="liveCalculate()" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black">
            </div>
            
            <div class="mb-3">
                <label for="mileage" class="text-sm font-medium text-gray-700">ğŸ›µ ç•¶æ—¥é¨ä¹˜å…¬é‡Œæ•¸ (km)</label>
                <input type="number" step="0.1" id="mileage" placeholder="è¼¸å…¥å…¬é‡Œæ•¸ (å…è¨±å°æ•¸)" oninput="liveCalculate()" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black">
            </div>

            <!-- å·¥ä½œæ™‚æ•¸è¼¸å…¥ (å°æ™‚/åˆ†é˜) -->
            <div class="mb-5 flex space-x-4">
                <div class="w-1/2">
                    <label for="hours" class="text-sm font-medium text-gray-700">ğŸ•’ å·¥ä½œæ™‚æ•¸ (å°æ™‚)</label>
                    <input type="number" id="hours" placeholder="0" oninput="liveCalculate()" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black">
                </div>
                <div class="w-1/2">
                    <label for="minutes" class="text-sm font-medium text-gray-700">å·¥ä½œæ™‚æ•¸ (åˆ†é˜)</label>
                    <input type="number" id="minutes" placeholder="0" oninput="liveCalculate()" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black">
                </div>
            </div>
            <!-- /å·¥ä½œæ™‚æ•¸è¼¸å…¥ -->


            <!-- å³æ™‚è¨ˆç®—é¡¯ç¤ºå€ (å„ªåŒ–é¡¯ç¤ºç´°ç¯€ï¼Œä¿®å¾©è¨ˆç®—ä¸é¡¯ç¤ºå•é¡Œ) -->
            <div class="p-4 mb-5 rounded-xl border border-dashed border-gray-300 bg-yellow-50">
                <h3 class="text-sm font-semibold mb-3">âš¡ å³æ™‚é ä¼°çµæœ</h3>
                
                <!-- Row 1: ç‡Ÿæ¥­é¡ vs ç¸½æˆæœ¬ -->
                <div class="grid grid-cols-2 text-sm gap-2 mb-2 border-b pb-2">
                    <div class="text-left font-semibold">ç‡Ÿæ¥­é¡: <span id="liveGrossIncome" class="font-bold text-black">$0.0</span></div>
                    <div class="text-right font-semibold">ç¸½æˆæœ¬: <span id="liveTotalCost" class="cost-val font-bold">$0.0</span></div>
                </div>
                
                <!-- Row 2: æ·¨åˆ© vs æˆæœ¬æ˜ç´° -->
                <div class="grid grid-cols-2 text-sm gap-2 mb-3">
                    <div class="text-left text-lg font-bold">æ·¨åˆ©: <span id="liveNetProfit" class="font-bold net-profit cost-val">$0.0</span></div>
                    <div class="text-right text-xs pt-1">
                        æ²¹è²»: <span id="liveGasCost" class="font-medium text-blue-700">$0.0</span><br>
                        è€—æè²»: <span id="liveMaintCost" class="font-medium text-red-700">$0.0</span>
                    </div>
                </div>


                <!-- Row 3: æ™‚è–ªè¨ˆç®— -->
                <div class="grid grid-cols-2 text-sm gap-2 pt-3 border-t border-gray-200">
                    <div class="text-left font-semibold">æ™‚è–ª (æ¯›åˆ©): <span id="liveGrossHourly" class="font-bold text-yellow-700">$0.0/hr</span></div>
                    <div class="text-right font-semibold">æ™‚è–ª (æ·¨åˆ©): <span id="liveNetHourly" class="font-bold net-profit cost-val">$0.0/hr</span></div>
                </div>
                
            </div>
            
            <button onclick="addRecord()" class="w-full bg-black hover:bg-gray-800 text-white font-bold py-3 rounded-xl transition duration-200 shadow-md">
                âœ… å„²å­˜åˆ°é›²ç«¯ (æ­£å¼ç´€éŒ„)
            </button>
        </div>

        <!-- 3. å ±è¡¨å€ -->
        <div class="bg-white p-5 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-4 border-b pb-2">ğŸ“ˆ æ·¨åˆ©å ±è¡¨ç¸½è¦½</h2>

            <!-- é ç±¤å°èˆª (åç¨±å·²æ›´æ”¹) -->
            <div class="flex justify-around mb-4 border-b border-gray-200">
                <div id="tab-day" class="tab py-2 px-3 cursor-pointer text-gray-500 font-semibold active" onclick="switchTab('day')">æ—¥</div>
                <div id="tab-week" class="tab py-2 px-3 cursor-pointer text-gray-500 font-semibold" onclick="switchTab('week')">é€±</div>
                <div id="tab-month" class="tab py-2 px-3 cursor-pointer text-gray-500 font-semibold" onclick="switchTab('month')">æœˆ</div>
                <div id="tab-year" class="tab py-2 px-3 cursor-pointer text-gray-500 font-semibold" onclick="switchTab('year')">å¹´</div>
            </div>

            <!-- å ±è¡¨å°èˆªèˆ‡æ¨™é¡Œ (é»æ“Šæ¨™é¡Œå¯è·³è½‰) -->
            <div class="flex justify-between items-center mb-4">
                <button onclick="navigateReport(-1)" class="p-2 text-xl font-bold rounded-full bg-gray-100 hover:bg-gray-200 transition duration-150">
                    &lt;
                </button>
                <button onclick="openDateSelector()" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition duration-150">
                    <h3 id="report-title-text" class="text-base font-semibold text-center text-gray-800"></h3>
                </button>
                <button onclick="navigateReport(1)" class="p-2 text-xl font-bold rounded-full bg-gray-100 hover:bg-gray-200 transition duration-150">
                    &gt;
                </button>
            </div>


            <!-- å ±è¡¨å…§å®¹ -->
            <div id="report-area">
                <!-- æ•¸æ“šå’Œåœ“é¤…åœ–æœƒå‹•æ…‹è¼‰å…¥è‡³æ­¤ -->
            </div>
        </div>
        
    </main>
</body>
</html>

Add index.html for Github Pages
