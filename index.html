<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Uber Driver è¨ˆç®—å™¨ï¼ˆæœ€çµ‚ç‰ˆï¼‰</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/base.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/components.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/utilities.min.css">
<style>
input, button { outline: none; }
.card { @apply bg-white shadow-md rounded-xl p-5 mb-5; }
.btn-main { @apply bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 transition w-full; }
.btn-sub { @apply bg-gray-200 text-gray-700 rounded-lg px-4 py-2 hover:bg-gray-300 transition; }
</style>
</head>
<body class="bg-gray-100 p-4">
<h1 class="text-2xl font-bold text-center mb-4">Uber Driver è¨ˆç®—å™¨ï¼ˆæœ€çµ‚ç‰ˆï¼‰</h1>
<div id="oilPriceDisplayMain" class="text-center text-blue-600 font-semibold mb-4">è®€å–ä¸­...</div>

<!-- æ²¹å“ç¨®é¡é¸æ“‡ -->
<div class="card">
  <h2 class="text-xl font-semibold mb-3">æ²¹å“ç¨®é¡</h2>
  <label>é¸æ“‡æ²¹å“</label>
  <select id="oilType" class="w-full border p-2 rounded mb-3" onchange="fetchOilPrice()">
      <option value="92" selected>ç„¡é‰›æ±½æ²¹92</option>
      <option value="95">ç„¡é‰›æ±½æ²¹95</option>
      <option value="98">ç„¡é‰›æ±½æ²¹98</option>
      <option value="91">ç„¡é‰›æ±½æ²¹91</option>
  </select>
</div>

<!-- æˆæœ¬è¨­å®šå€ -->
<div class="card">
<h2 class="text-xl font-semibold mb-3">æˆæœ¬è¨­å®šï¼ˆé›²ç«¯å„²å­˜ï¼‰</h2>
<label>æ²¹è€—è¨­å®š (km/L)</label>
<input id="fuelRate" class="w-full border p-2 rounded mb-3" />
<label>æ¯å…¬é‡Œè€—ææˆæœ¬ ($/km)</label>
<input id="maintCost" class="w-full border p-2 rounded mb-3" />
<button class="btn-main" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
</div>

<!-- ç•¶æ—¥æ•¸æ“šè¼¸å…¥ -->
<div class="card">
<h2 class="text-xl font-semibold mb-3">ç•¶æ—¥æ•¸æ“šè¼¸å…¥</h2>
<label>è¨˜éŒ„æ—¥æœŸ</label>
<input id="recordDate" type="date" class="w-full border p-2 rounded mb-3" />
<label>ç•¶æ—¥ç‡Ÿæ¥­é¡</label>
<input id="dayIncome" class="w-full border p-2 rounded mb-3" />
<label>ç•¶æ—¥å¯¦éš›å…¬é‡Œæ•¸</label>
<input id="dayDistance" class="w-full border p-2 rounded mb-3" />
<label>å·¥ä½œæ™‚æ•¸</label>
<input id="workHours" class="w-full border p-2 rounded mb-3" />
<button class="btn-main" onclick="saveRecord()">å„²å­˜ç´€éŒ„</button>
</div>

<!-- ç•¶æ—¥è¨ˆç®—çµæœ -->
<div class="card">
<h2 class="text-xl font-semibold mb-3">å³æ™‚é ä¼°</h2>
<div id="previewResult" class="text-gray-800">å°šç„¡è³‡æ–™</div>
</div>

<!-- æ­·å²ç´€éŒ„ -->
<div class="card">
<h2 class="text-xl font-semibold mb-3">æ­·å²ç´€éŒ„</h2>
<div id="historyList" class="space-y-3"></div>
</div>

<script>
const workerAPI = "https://ubereat-oil-proxy.leo3026772.workers.dev";
let globalOilPrice = 27.1;

async function fetchOilPrice() {
    try {
        const res = await fetch(workerAPI);
        const data = await res.json();

        const oilType = document.getElementById('oilType').value;

        // é˜²å‘†ï¼šæ²’æœ‰æ²¹å“é™£åˆ—å°± fallback
        if (!data.oils) {
            document.getElementById('oilPriceDisplayMain').textContent = `æ²¹åƒ¹è®€å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­ $${globalOilPrice}/L`;
            return;
        }

        const item = data.oils.find(o => o.type === oilType);

        if (!item) {
            document.getElementById('oilPriceDisplayMain').textContent = `æŸ¥ç„¡ ${oilType} æ²¹åƒ¹ï¼Œä½¿ç”¨é è¨­ $${globalOilPrice}/L`;
            return;
        }

        globalOilPrice = parseFloat(item.price);
        document.getElementById('oilPriceDisplayMain').textContent = `${item.name}ï¼š$${item.price}/L`;

    } catch (err) {
        document.getElementById('oilPriceDisplayMain').textContent = `æ²¹åƒ¹è®€å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­ $${globalOilPrice}/L`;
    }
}

function saveSettings() {
    const fuelRate = document.getElementById('fuelRate').value;
    const maint = document.getElementById('maintCost').value;
    localStorage.setItem('fuelRate', fuelRate);
    localStorage.setItem('maintCost', maint);
    alert('è¨­å®šå·²å„²å­˜');
}

function loadSettings() {
    document.getElementById('fuelRate').value = localStorage.getItem('fuelRate') || 40;
    document.getElementById('maintCost').value = localStorage.getItem('maintCost') || 0.6;
}

function saveRecord() {
    const record = {
        date: document.getElementById('recordDate').value,
        income: parseFloat(document.getElementById('dayIncome').value || 0),
        km: parseFloat(document.getElementById('dayDistance').value || 0),
        hours: parseFloat(document.getElementById('workHours').value || 0)
    };

    const all = JSON.parse(localStorage.getItem('history') || '[]');
    all.push(record);
    localStorage.setItem('history', JSON.stringify(all));

    alert('ç´€éŒ„å·²å„²å­˜');
    loadHistory();
}

function loadHistory() {
    const list = document.getElementById('historyList');
    list.innerHTML = "";

    const all = JSON.parse(localStorage.getItem('history') || '[]');

    all.forEach((r, idx) => {
        const div = document.createElement('div');
        div.className = "border p-3 rounded-lg bg-gray-50";
        div.innerHTML = `
            <div>ğŸ“… ${r.date}</div>
            <div>ç‡Ÿæ¥­é¡ï¼š$${r.income}</div>
            <div>å…¬é‡Œæ•¸ï¼š${r.km} km</div>
            <div>æ™‚æ•¸ï¼š${r.hours} å°æ™‚</div>
            <div class='flex space-x-2 mt-2'>
                <button class='btn-sub' onclick='editRecord(${idx})'>ç·¨è¼¯</button>
                <button class='btn-sub' onclick='deleteRecord(${idx})'>åˆªé™¤</button>
            </div>`;
        list.appendChild(div);
    });
}

function editRecord(i) {
    const all = JSON.parse(localStorage.getItem('history') || '[]');
    const r = all[i];
    document.getElementById('recordDate').value = r.date;
    document.getElementById('dayIncome').value = r.income;
    document.getElementById('dayDistance').value = r.km;
    document.getElementById('workHours').value = r.hours;
    alert('å·²è¼‰å…¥è‡³è¼¸å…¥æ¬„ä½ï¼Œå¯ä¿®æ”¹å¾Œé‡æ–°å„²å­˜ã€‚');
}

function deleteRecord(i) {
    const all = JSON.parse(localStorage.getItem('history') || '[]');
    all.splice(i, 1);
    localStorage.setItem('history', JSON.stringify(all));
    loadHistory();
}

window.onload = () => {
    fetchOilPrice();
    loadSettings();
    loadHistory();
};
</script>
</body>
</html>
